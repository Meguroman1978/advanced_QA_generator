# 📖 Chrome拡張機能 使い方ガイド（改善版）

## ✅ 最新の変更点（v1.1）

従来の自動転送方式から**クリップボードコピー方式**に変更しました。

### なぜ変更したのか？

- ❌ **旧方式**: WebページからChrome拡張機能のストレージにアクセスできない（セキュリティ制限）
- ✅ **新方式**: クリップボードを使用（すべてのユーザーが慣れている操作）

---

## 🚀 完全な使い方（ステップバイステップ）

### ステップ1: Chrome拡張機能の更新

```bash
cd ~/advanced_QA_generator
git pull origin main
```

1. `chrome://extensions/` を開く
2. 既存の「Q&A Generator - HTML Extractor」を**削除**
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. `~/advanced_QA_generator/BROWSER_EXTENSION` フォルダを選択
5. バージョンが **v1.1** になっていることを確認

---

### ステップ2: Webアプリのデプロイ

```bash
cd ~/advanced_QA_generator

# マシンを停止
flyctl machine stop --app advanced-qa-generator --force

# 10秒待機
sleep 10

# デプロイ
flyctl deploy --app advanced-qa-generator --no-cache
```

デプロイ完了後、https://advanced-qa-generator.fly.dev が更新されます。

---

### ステップ3: Q&A生成（実際の使用手順）

#### 3-1. ターゲットページを開く

ブラウザで以下のページを開く：
```
https://web.hh-online.jp/hankyu-beauty/goods/index.html?ggcd=B2470245&wid=99947307794445801
```

#### 3-2. 拡張機能でHTMLを抽出

1. ツールバーの **Q&A Generator - HTML Extractor** アイコンをクリック
2. ポップアップが開く（現在のURLが表示される）
3. **「📄 このページのHTMLを抽出」** ボタンをクリック
4. 数秒後、成功メッセージが表示される：
   ```
   ✅ HTML抽出成功！
   サイズ: 122.85 KB
   タイトル: ジェニフィック アルティメ セラム...
   次: 「HTMLをコピー」をクリック
   ```

#### 3-3. HTMLをクリップボードにコピー

1. **「📋 HTMLをコピー」** ボタンをクリック（オレンジ色）
2. 成功メッセージが表示される：
   ```
   ✅ クリップボードにコピーしました！
   サイズ: 122.85 KB
   次: 「Q&A Generator を開く」をクリック
   ```

#### 3-4. Q&A Generatorを開く

1. **「🌐 Q&A Generator を開く」** ボタンをクリック
2. 新しいタブで https://advanced-qa-generator.fly.dev が開く

#### 3-5. ソースコード挿入モードを有効化

1. 緑色のボックス内の **「📝 ソースコード挿入を有効化」** ボタンをクリック
2. ボタンがオレンジ色に変わり、「✅ ソースコード挿入モード（有効）」と表示される
3. 下にオレンジ色のテキストエリアが表示される

#### 3-6. HTMLを貼り付け

1. オレンジ色のテキストエリア内をクリック
2. キーボードショートカットで貼り付け：
   - **Mac**: `Cmd + V`
   - **Windows**: `Ctrl + V`
3. HTMLコードが表示され、下に成功メッセージが表示される：
   ```
   ✅ HTMLが貼り付けられました（122.85 KB）
   ```

#### 3-7. URLを入力

「Webサイト URL」フィールドに以下を入力：
```
https://web.hh-online.jp/hankyu-beauty/goods/index.html?ggcd=B2470245&wid=99947307794445801
```

#### 3-8. Q&A生成を実行

1. **「Q&Aを生成」** ボタンをクリック
2. 「Webページを取得してQ&Aを生成中...」と表示される
3. 約30-45秒待つ

#### 3-9. 結果の確認

成功すると、3-5個のQ&Aが表示されます：

```
Q1: ジェニフィック アルティメ セラムの主な特徴は何ですか？
A1: このセラムは肌の回復力を高め、透明感のある肌へ導く美容液です...

Q2: このセラムの使用方法を教えてください。
A2: 洗顔後、化粧水の前に適量を手に取り...

Q3: どのような肌質に適していますか？
A3: すべての肌質の方にお使いいただけます...
```

---

## 🎯 各ステップのスクリーンショット位置

### 拡張機能ポップアップ

```
┌─────────────────────────────────┐
│ Q&A Generator - HTML抽出        │
├─────────────────────────────────┤
│ 現在のページ:                    │
│ https://web.hh-online.jp/...    │
│                                 │
│ [📄 このページのHTMLを抽出]     │ ← ステップ1
│ [📋 HTMLをコピー]               │ ← ステップ2（抽出後に表示）
│ [🌐 Q&A Generator を開く]       │ ← ステップ3
│                                 │
│ ✅ クリップボードにコピー...    │
│ サイズ: 122.85 KB               │
│ 次: 「Q&A Generator を開く」... │
└─────────────────────────────────┘
```

### Webアプリ画面

```
┌─────────────────────────────────────────────┐
│ Web Q&A Generator                           │
├─────────────────────────────────────────────┤
│ 🔓 ボット検知を100%回避する方法             │
│                                             │
│ Chrome拡張機能を使用した手順：              │
│ 1. ターゲットページで拡張機能を開く        │
│ 2. 「このページのHTMLを抽出」をクリック     │
│ 3. 「HTMLをコピー」をクリック               │
│ 4. 「Q&A Generator を開く」をクリック       │
│ 5. 下の「ソースコード挿入を有効化」をクリック│
│ 6. テキストエリアに貼り付け（Cmd+V）        │
│ 7. URLを入力して「Q&Aを生成」をクリック     │
│                                             │
│ [📝 ソースコード挿入を有効化]              │ ← クリック
├─────────────────────────────────────────────┤
│ 📋 HTMLソースコード（Chrome拡張機能でコピー...│
│                                             │
│ 貼り付け方法: テキストエリア内をクリック →  │
│ Cmd+V (Mac) または Ctrl+V (Windows)         │
│                                             │
│ ┌─────────────────────────────────────────┐ │
│ │ ここをクリック → Cmd+V で貼り付け       │ │ ← 貼り付け
│ │                                         │ │
│ │ <!DOCTYPE html>                         │ │
│ │ <html>...                               │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ ✅ HTMLが貼り付けられました（122.85 KB）    │
│                                             │
│ Webサイト URL:                              │
│ [https://web.hh-online.jp/...]             │
│                                             │
│ [Q&Aを生成]                                │ ← 最終クリック
└─────────────────────────────────────────────┘
```

---

## ⚠️ トラブルシューティング

### 問題1: 「HTMLをコピー」ボタンが表示されない

**原因**: 古いバージョン（v1.0）を使用している

**解決方法**:
```bash
cd ~/advanced_QA_generator
git pull origin main
```
その後、`chrome://extensions/` で拡張機能を削除して再読み込み

---

### 問題2: 貼り付けても何も表示されない

**原因**: クリップボードにHTMLがコピーされていない

**解決方法**:
1. 拡張機能のポップアップに戻る
2. 「📋 HTMLをコピー」ボタンを再度クリック
3. 成功メッセージを確認
4. Q&A Generatorに戻って再度貼り付け

---

### 問題3: デプロイ後も緑色のボックスが表示されない

**原因**: ブラウザキャッシュ

**解決方法**:
1. `Cmd + Shift + R` (Mac) または `Ctrl + Shift + R` (Windows) でハードリフレッシュ
2. または、ブラウザキャッシュをクリア

---

### 問題4: Q&A生成がゼロ件

**原因**: HTMLが正しく貼り付けられていない、またはURLが間違っている

**確認方法**:
1. オレンジ色のテキストエリアに `<!DOCTYPE html>` などのHTMLコードが表示されているか
2. 「✅ HTMLが貼り付けられました」メッセージが表示されているか
3. URLフィールドに正しいURLが入力されているか

---

## 📊 期待される結果

### 成功時のサーバーログ

```bash
flyctl logs --app advanced-qa-generator --tail 20
```

**期待される出力**:
```
✅ Using HTML from browser extension (bypasses all bot detection)
sourceCode provided: true length: 125847
Extracting content...
[GENERATION] Generated 5 Q&A items
```

### 生成されるQ&A例

```json
{
  "success": true,
  "data": {
    "qaItems": [
      {
        "id": "1",
        "question": "ジェニフィック アルティメ セラムの主な特徴は何ですか？",
        "answer": "肌の回復力を高め、透明感のある肌へ導く美容液です..."
      },
      // ... 他のQ&A
    ]
  }
}
```

---

## 🎉 まとめ

この新しいワークフローにより：

- ✅ **100%確実**: ボット検知を完全回避
- ✅ **シンプル**: コピー＆ペーストだけ
- ✅ **直感的**: すべてのユーザーが慣れている操作
- ✅ **高速**: 約1分で完了

---

**最終更新**: 2025-12-10  
**コミット**: `c1f98be`  
**GitHub**: https://github.com/Meguroman1978/advanced_QA_generator
