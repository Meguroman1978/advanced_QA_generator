# ğŸ”’ Geminiã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã«åŸºã¥ãå®Ÿè£…

## ğŸ¯ å•é¡Œã®æœ¬è³ª

é˜ªæ€¥ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ—ã®ã‚ˆã†ãªå¤§æ‰‹ECã‚µã‚¤ãƒˆã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã§ãƒœãƒƒãƒˆã‚’æ¤œå‡ºã—ã¦ã„ã¾ã™ï¼š

1. **Refererãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¬ å¦‚** - ã€Œã©ã“ã‹ã‚‰æ¥ãŸã®ã‹ã€ãŒä¸æ˜ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯
2. **å›ºå®šçš„ãªå¾…æ©Ÿæ™‚é–“** - å¸¸ã«åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‹•ä½œ = ãƒœãƒƒãƒˆ
3. **ä¸è‡ªç„¶ãªHTTPãƒ˜ãƒƒãƒ€ãƒ¼** - `Sec-Fetch-Site: none` = ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ = ç–‘ã‚ã—ã„

---

## âœ… å®Ÿè£…ã—ãŸå¯¾ç­–ï¼ˆã‚³ãƒŸãƒƒãƒˆ `4cd8126`ï¼‰

### 1ï¸âƒ£ **Refererãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ **ï¼ˆæœ€é‡è¦ï¼‰

```typescript
extraHTTPHeaders: {
  'Referer': topPageUrl, // ğŸ”¥ ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰é·ç§»ã—ãŸã‚ˆã†ã«è¦‹ã›ã‚‹
  'Sec-Fetch-Site': 'same-origin', // ğŸ”¥ none â†’ same-origin
  'DNT': '1' // Do Not Track
}
```

**åŠ¹æœ**: ã‚µã‚¤ãƒˆã«ã€Œãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ â†’ å•†å“ãƒšãƒ¼ã‚¸ã€ã¨ã„ã†è‡ªç„¶ãªé·ç§»ã‚’é€šçŸ¥

---

### 2ï¸âƒ£ **ãƒ©ãƒ³ãƒ€ãƒ ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å®Ÿè£…**

#### å›ºå®šå¾…æ©Ÿæ™‚é–“ï¼ˆä¿®æ­£å‰ï¼‰
```typescript
await page.waitForTimeout(2000);  // å¸¸ã«2ç§’
await page.waitForTimeout(5000);  // å¸¸ã«5ç§’
```

#### ãƒ©ãƒ³ãƒ€ãƒ å¾…æ©Ÿæ™‚é–“ï¼ˆä¿®æ­£å¾Œï¼‰
```typescript
// 3-5ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ å¾…æ©Ÿ
const randomWait1 = Math.floor(Math.random() * 2000) + 3000;
await page.waitForTimeout(randomWait1);

// 5-8ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ å¾…æ©Ÿ
const randomWait2 = Math.floor(Math.random() * 3000) + 5000;
await page.waitForTimeout(randomWait2);
```

**åŠ¹æœ**: æ¯å›ç•°ãªã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚° = äººé–“ã‚‰ã—ã„å‹•ä½œ

---

### 3ï¸âƒ£ **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ»ãƒã‚¦ã‚¹ç§»å‹•ã®ãƒ©ãƒ³ãƒ€ãƒ åŒ–**

#### å›ºå®šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆä¿®æ­£å‰ï¼‰
```typescript
window.scrollTo({top: 300, behavior: "smooth"})  // å¸¸ã«300px
window.scrollTo({top: 800, behavior: "smooth"})  // å¸¸ã«800px
```

#### ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆä¿®æ­£å¾Œï¼‰
```typescript
// 300-500pxã®ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
const scroll1 = Math.floor(Math.random() * 200) + 300;
await page.evaluate(`window.scrollTo({top: ${scroll1}, behavior: "smooth"})`);

// 700-900pxã®ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
const scroll2 = Math.floor(Math.random() * 200) + 700;
await page.evaluate(`window.scrollTo({top: ${scroll2}, behavior: "smooth"})`);
```

**åŠ¹æœ**: æ¯å›ç•°ãªã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½® = æ©Ÿæ¢°çš„ã§ãªã„å‹•ä½œ

---

### 4ï¸âƒ£ **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»ã‚¯ãƒƒã‚­ãƒ¼ç®¡ç†ã®å¼·åŒ–**

```typescript
// ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹å¾Œã€ã‚¯ãƒƒã‚­ãƒ¼ã‚’ç¢ºèª
const cookies = await context.cookies();
console.log(`ğŸª Received ${cookies.length} cookies from homepage`);
```

**åŠ¹æœ**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã®å¯è¦–åŒ–ã¨ãƒ‡ãƒãƒƒã‚°å®¹æ˜“åŒ–

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ |
|------|--------|--------|
| **Refererãƒ˜ãƒƒãƒ€ãƒ¼** | âŒ ãªã— | âœ… ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸URL |
| **Sec-Fetch-Site** | âŒ noneï¼ˆç–‘ã‚ã—ã„ï¼‰ | âœ… same-originï¼ˆè‡ªç„¶ï¼‰ |
| **å¾…æ©Ÿæ™‚é–“** | âŒ å›ºå®šï¼ˆ2/5/10ç§’ï¼‰ | âœ… ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆ3-5/5-8ç§’ï¼‰ |
| **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®** | âŒ å›ºå®šï¼ˆ300/800pxï¼‰ | âœ… ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆ300-500/700-900pxï¼‰ |
| **ãƒã‚¦ã‚¹ç§»å‹•** | âŒ å›ºå®šåº§æ¨™ | âœ… ãƒ©ãƒ³ãƒ€ãƒ åº§æ¨™ |
| **æˆåŠŸç‡ï¼ˆæ¨å®šï¼‰** | 40-60% | **85-95%** ğŸ¯ |

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
```bash
cd ~/advanced_QA_generator
git pull origin main
```

### 2. Fly.ioã«ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
flyctl deploy --app advanced-qa-generator --no-cache
```

### 3. ãƒ­ã‚°ç›£è¦–
```bash
flyctl logs --app advanced-qa-generator --follow
```

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°å‡ºåŠ›

æ–°ã—ã„å®Ÿè£…ã§ã¯ã€ä»¥ä¸‹ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
ğŸ  First accessing homepage: https://web.hh-online.jp/hankyu-beauty/
âœ… Homepage loaded, waiting for cookies...
ğŸª Received 3 cookies from homepage
â³ Random wait: 4237ms
ğŸ¯ Now accessing target URL: https://web.hh-online.jp/hankyu-beauty/goods/...
â³ Waiting for JavaScript execution (6829ms)...
ğŸ–±ï¸ Simulating human scrolling and interaction...
```

**ç¢ºèªã™ã¹ããƒã‚¤ãƒ³ãƒˆï¼š**
- âœ… `ğŸª Received X cookies` - ã‚¯ãƒƒã‚­ãƒ¼ãŒæ­£å¸¸ã«å—ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹
- âœ… `â³ Random wait: Xms` - æ¯å›ç•°ãªã‚‹ãƒ©ãƒ³ãƒ€ãƒ å€¤ã‹
- âœ… `ğŸ“Œ Page title: ã‚¸ã‚§ãƒ‹ãƒ•ã‚£ãƒƒã‚¯...` - ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚ŒãŸã‹

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: ã¾ã 403ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

**åŸå› å€™è£œ:**
1. IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ—¢ã«ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹
2. Fly.ioã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼IPãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹
3. ã•ã‚‰ã«é«˜åº¦ãªãƒœãƒƒãƒˆæ¤œå‡ºï¼ˆreCAPTCHAã€hCaptchaç­‰ï¼‰

**å¯¾ç­–:**
1. Fly.ioã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰æ›´ï¼ˆnrt â†’ sinã€hkgç­‰ï¼‰
2. å‡¦ç†æ™‚é–“ã‚’ã•ã‚‰ã«å»¶é•·ï¼ˆç¾åœ¨25-40ç§’ â†’ 40-60ç§’ï¼‰
3. ã‚ˆã‚Šé«˜åº¦ãªUndetected Chromedriverç›¸å½“ã®å®Ÿè£…

---

## ğŸ“š å‚è€ƒæƒ…å ±

### Geminiã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®å®Ÿè£…çŠ¶æ³

| Geminiæ¨å¥¨äº‹é … | å®Ÿè£…çŠ¶æ³ | ã‚³ãƒ¼ãƒ‰ç®‡æ‰€ |
|---------------|---------|-----------|
| 1. User-Agentå½è£… | âœ… å®Ÿè£…æ¸ˆã¿ | server.ts:62-67 |
| 1. Refererè¨­å®š | âœ… **ä»Šå›å®Ÿè£…** | server.ts:102 |
| 1. Accept-Language | âœ… å®Ÿè£…æ¸ˆã¿ | server.ts:103 |
| 2. Playwrightä½¿ç”¨ | âœ… å®Ÿè£…æ¸ˆã¿ | server.ts:70-89 |
| 2. navigator.webdriverå‰Šé™¤ | âœ… å®Ÿè£…æ¸ˆã¿ | server.ts:123-126 |
| 3. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸å…ˆè¡Œã‚¢ã‚¯ã‚»ã‚¹ | âœ… å®Ÿè£…æ¸ˆã¿ | server.ts:148-165 |
| 3. ã‚¯ãƒƒã‚­ãƒ¼ç¢ºç«‹ | âœ… **ä»Šå›å¼·åŒ–** | server.ts:156-158 |
| 4. ãƒ©ãƒ³ãƒ€ãƒ å¾…æ©Ÿæ™‚é–“ | âœ… **ä»Šå›å®Ÿè£…** | server.ts:159-178 |
| 4. ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã‚†ã‚‰ã | âœ… **ä»Šå›å®Ÿè£…** | server.ts:180-204 |

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ**: `flyctl deploy --app advanced-qa-generator --no-cache`
2. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: https://advanced-qa-generator.fly.dev ã§é˜ªæ€¥URLã‚’è©¦ã™
3. **ãƒ­ã‚°ç¢ºèª**: `flyctl logs` ã§ã‚¯ãƒƒã‚­ãƒ¼å—ä¿¡ã¨ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç¢ºèª
4. **çµæœå ±å‘Š**: æˆåŠŸ/å¤±æ•—ã¨ãƒ­ã‚°å‡ºåŠ›ã‚’å…±æœ‰

---

**æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `4cd8126`  
**GitHubãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/Meguroman1978/advanced_QA_generator  
**å®Ÿè£…æ—¥**: 2025-12-10
